import{c as F,u as k,a as S,b as P,r as d,j as s,d as l,e as y,s as w,t as E,f as U,g as $}from"./index-517427dd.js";(function(){try{var i=typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},a=new Error().stack;a&&(i._sentryDebugIds=i._sentryDebugIds||{},i._sentryDebugIds[a]="4e9d2590-1b48-4f62-8ea1-96fd3572916d",i._sentryDebugIdIdentifier="sentry-dbid-4e9d2590-1b48-4f62-8ea1-96fd3572916d")}catch{}})();const B=F("Paperclip",[["path",{d:"m21.44 11.05-9.19 9.19a6 6 0 0 1-8.49-8.49l8.57-8.57A4 4 0 1 1 18 8.84l-8.59 8.57a2 2 0 0 1-2.83-2.83l8.49-8.48",key:"1u3ebp"}]]),b=()=>w.dispatch(E(!1)),z=()=>{var h,g;const i=k(n=>n.ui.global.showIdentificationForm),{data:{data:a}={}}=S(),[f,{isLoading:x}]=P(),[o,m]=d.useState(a==null?void 0:a.members),[c,j]=d.useState([]),[v,p]=d.useState(!1);d.useEffect(()=>{a&&m(a.members)},[a]);const I=async n=>{if(n.preventDefault(),o.find(({nic:e,meal_preference:r,gender:N,student_id_url:A},_)=>!e||!c[_]&&!A||!r||!N))return l.toast({variant:"destructive",title:"Please make sure that all required fields are filled"});p(!0);const t=await Promise.all(o.map(async(e,r)=>(c[r]&&(e.student_id_url=await U(a.name,e.name,c[r])),e))).finally(()=>p(!1));await f({id:a._id,data:{members:t}}).unwrap().then(e=>{w.dispatch($.util.upsertQueryData("authUser",void 0,{data:e==null?void 0:e.data})),b(),l.toast({title:"Details recorded successfully"})})},D=(n,t)=>{j(e=>{const r=[...e];return r[t]=n.target.files[0],r})},u=(n,t)=>{const e=JSON.parse(JSON.stringify(o));e[t][n.target.name]=n.target.value,m(e)},C=(h=a==null?void 0:a.members)==null?void 0:h.some(n=>n.nic);return s.jsx(l.AlertDialog,{open:i,onOpenChange:n=>{n||b()},children:s.jsx(l.AlertDialogContent,{className:"max-h-[90vh] overflow-y-auto z-[200]",overlayClassName:"bg-white/80 backdrop-blur-md z-[200]",children:s.jsxs("form",{onSubmit:I,className:"flex flex-col gap-3",children:[s.jsxs(l.AlertDialogHeader,{children:[s.jsx(l.AlertDialogTitle,{children:"Hello there!"}),s.jsx(l.AlertDialogDescription,{children:C?"Looks like you've strengthened your battlion. Before we can allow your team to compete further please confirm the identity of your new members by filling what's missing below.":`Congratulations on making it to the final round of Bashaway ${new Date().getFullYear()}. However, before you can compete further,
              please fill in the following details.`})]}),s.jsx(l.Accordion,{type:"single",defaultValue:`member-${(g=a==null?void 0:a.members)==null?void 0:g.findIndex(n=>!n.nic)}`,collapsible:!0,children:o==null?void 0:o.map((n,t)=>s.jsxs(l.AccordionItem,{value:`member-${t}`,children:[s.jsx(l.AccordionTrigger,{children:n.name}),s.jsxs(l.AccordionContent,{containerClassName:"flex flex-col gap-3",children:[s.jsxs("div",{className:"flex flex-col md:flex-row gap-3",children:[s.jsx(l.Dropdown,{filterkey:"meal_preference",label:"Meal Preference *",options:y.mealPreference.options,className:"sm:h-14",value:o[t].meal_preference,onChange:e=>u(e,t)}),s.jsx(l.Dropdown,{filterkey:"gender",label:"Gender *",options:y.gender.options,className:"sm:h-14",contentClassName:"max-h-[8.5rem] overflow-y-auto invisible-scroll",value:o[t].gender,onChange:e=>u(e,t)})]}),s.jsx(l.Input,{placeholder:"NIC *",name:"nic",value:o[t].nic,className:"sm:h-14",onChange:e=>u(e,t)}),s.jsx(l.Input,{placeholder:"University ID (both sides) *",name:"student_id_url",value:c[t]?c[t].name:o[t].student_id_url,className:"sm:h-14 cursor-pointer",onClick:()=>document.getElementById(`id-upload-${t}`).click(),suffixIcon:s.jsx(B,{className:"text-gray-400 pointer-events-none",size:21}),readOnly:!0}),s.jsx("input",{id:`id-upload-${t}`,type:"file",className:"hidden",onChange:e=>D(e,t)})]})]},t))}),s.jsx(l.AlertDialogFooter,{className:"mt-4",children:s.jsx(l.Button,{type:"submit",loading:x||v,children:"Submit and continue"})})]})})})};export{z as default};
//# sourceMappingURL=identification-form-070769e2.js.map
