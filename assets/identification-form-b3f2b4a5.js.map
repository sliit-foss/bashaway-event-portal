{"version":3,"file":"identification-form-b3f2b4a5.js","sources":["../../node_modules/.pnpm/lucide-react@0.263.1_react@18.0.0/node_modules/lucide-react/dist/esm/icons/paperclip.mjs","../../src/components/identification-form.jsx"],"sourcesContent":["/**\n * lucide-react v0.0.1 - ISC\n */\n\nimport createLucideIcon from '../createLucideIcon.mjs';\n\nconst Paperclip = createLucideIcon(\"Paperclip\", [\n  [\n    \"path\",\n    {\n      d: \"m21.44 11.05-9.19 9.19a6 6 0 0 1-8.49-8.49l8.57-8.57A4 4 0 1 1 18 8.84l-8.59 8.57a2 2 0 0 1-2.83-2.83l8.49-8.48\",\n      key: \"1u3ebp\"\n    }\n  ]\n]);\n\nexport { Paperclip as default };\n//# sourceMappingURL=paperclip.mjs.map\n","import { useEffect, useState } from \"react\";\nimport { Paperclip } from \"lucide-react\";\nimport { useSelector } from \"react-redux\";\nimport { uploadIdCard } from \"@/services\";\nimport { store } from \"@/store\";\nimport { authApi, useAuthUserQuery, useUpdateProfileMutation } from \"@/store/api\";\nimport { toggleIdentificationForm } from \"@/store/reducers/ui/global\";\nimport {\n  Accordion,\n  AccordionContent,\n  AccordionItem,\n  AccordionTrigger,\n  AlertDialog,\n  AlertDialogContent,\n  AlertDialogDescription,\n  AlertDialogFooter,\n  AlertDialogHeader,\n  AlertDialogTitle,\n  Button,\n  Dropdown,\n  Input,\n  toast\n} from \"@sliit-foss/bashaway-ui/components\";\nimport { gender, mealPreference } from \"@sliit-foss/bashaway-ui/constants\";\n\nconst close = () => store.dispatch(toggleIdentificationForm(false));\n\nconst IdentificationForm = () => {\n  const open = useSelector((store) => store.ui.global.showIdentificationForm);\n\n  const { data: { data: team } = {} } = useAuthUserQuery();\n\n  const [updateProfile, { isLoading }] = useUpdateProfileMutation();\n\n  const [formData, setFormData] = useState(team?.members);\n  const [idFiles, setIdFiles] = useState([]);\n  const [isUploading, setIsUploading] = useState(false);\n\n  useEffect(() => {\n    if (team) setFormData(team.members);\n  }, [team]);\n\n  const handleSubmit = async (e) => {\n    e.preventDefault();\n    if (\n      formData.find(\n        ({ nic, meal_preference, gender, student_id_url }, index) =>\n          !nic || (!idFiles[index] && !student_id_url) || !meal_preference || !gender\n      )\n    ) {\n      return toast({ variant: \"destructive\", title: \"Please make sure that all required fields are filled\" });\n    }\n    setIsUploading(true);\n    const members = await Promise.all(\n      formData.map(async (member, index) => {\n        if (idFiles[index]) member[\"student_id_url\"] = await uploadIdCard(team.name, member.name, idFiles[index]);\n        return member;\n      })\n    ).finally(() => setIsUploading(false));\n    await updateProfile({\n      id: team._id,\n      data: { members }\n    })\n      .unwrap()\n      .then((data) => {\n        store.dispatch(authApi.util.upsertQueryData(\"authUser\", undefined, { data: data?.data }));\n        close();\n        toast({ title: \"Details recorded successfully\" });\n      });\n  };\n\n  const onFileChange = (e, index) => {\n    setIdFiles((prev) => {\n      const newFiles = [...prev];\n      newFiles[index] = e.target.files[0];\n      return newFiles;\n    });\n  };\n\n  const onChange = (e, index) => {\n    const newFormData = JSON.parse(JSON.stringify(formData));\n    newFormData[index][e.target.name] = e.target.value;\n    setFormData(newFormData);\n  };\n\n  const partiallyFilled = team?.members?.some((m) => m.nic);\n\n  return (\n    <AlertDialog\n      open={open}\n      onOpenChange={(open) => {\n        if (!open) close();\n      }}\n    >\n      <AlertDialogContent\n        className=\"max-h-[90vh] overflow-y-auto z-[200]\"\n        overlayClassName=\"bg-white/80 backdrop-blur-md z-[200]\"\n      >\n        <form onSubmit={handleSubmit} className=\"flex flex-col gap-3\">\n          <AlertDialogHeader>\n            <AlertDialogTitle>Hello there!</AlertDialogTitle>\n            <AlertDialogDescription>\n              {partiallyFilled\n                ? `Looks like you've strengthened your battlion. Before we can allow your team to compete further please confirm the identity of your new members by filling what's missing below.`\n                : `Congratulations on making it to the final round of Bashaway ${new Date().getFullYear()}. However, before you can compete further,\n              please fill in the following details.`}\n            </AlertDialogDescription>\n          </AlertDialogHeader>\n          <Accordion type=\"single\" defaultValue={`member-${team?.members?.findIndex((m) => !m.nic)}`} collapsible>\n            {formData?.map((member, index) => (\n              <AccordionItem key={index} value={`member-${index}`}>\n                <AccordionTrigger>{member.name}</AccordionTrigger>\n                <AccordionContent containerClassName=\"flex flex-col gap-3\">\n                  <div className=\"flex flex-col md:flex-row gap-3\">\n                    <Dropdown\n                      filterkey=\"meal_preference\"\n                      label=\"Meal Preference *\"\n                      options={mealPreference.options}\n                      className=\"sm:h-14\"\n                      value={formData[index].meal_preference}\n                      onChange={(e) => onChange(e, index)}\n                    />\n                    <Dropdown\n                      filterkey=\"gender\"\n                      label=\"Gender *\"\n                      options={gender.options}\n                      className=\"sm:h-14\"\n                      contentClassName=\"max-h-[8.5rem] overflow-y-auto invisible-scroll\"\n                      value={formData[index].gender}\n                      onChange={(e) => onChange(e, index)}\n                    />\n                  </div>\n                  <Input\n                    placeholder=\"NIC *\"\n                    name=\"nic\"\n                    value={formData[index].nic}\n                    className=\"sm:h-14\"\n                    onChange={(e) => onChange(e, index)}\n                  />\n                  <Input\n                    placeholder=\"University ID (both sides) *\"\n                    name=\"student_id_url\"\n                    value={idFiles[index] ? idFiles[index].name : formData[index].student_id_url}\n                    className=\"sm:h-14 cursor-pointer\"\n                    onClick={() => document.getElementById(`id-upload-${index}`).click()}\n                    suffixIcon={<Paperclip className=\"text-gray-400 pointer-events-none\" size={21} />}\n                    readOnly\n                  />\n                  <input\n                    id={`id-upload-${index}`}\n                    type=\"file\"\n                    className=\"hidden\"\n                    onChange={(e) => onFileChange(e, index)}\n                  />\n                </AccordionContent>\n              </AccordionItem>\n            ))}\n          </Accordion>\n          <AlertDialogFooter className=\"mt-4\">\n            <Button type=\"submit\" loading={isLoading || isUploading}>\n              Submit and continue\n            </Button>\n          </AlertDialogFooter>\n        </form>\n      </AlertDialogContent>\n    </AlertDialog>\n  );\n};\n\nexport default IdentificationForm;\n"],"names":["Paperclip","createLucideIcon","close","store","toggleIdentificationForm","IdentificationForm","open","useSelector","team","useAuthUserQuery","updateProfile","isLoading","useUpdateProfileMutation","formData","setFormData","useState","idFiles","setIdFiles","isUploading","setIsUploading","useEffect","handleSubmit","e","nic","meal_preference","gender","student_id_url","index","toast","members","member","uploadIdCard","data","authApi","onFileChange","prev","newFiles","onChange","newFormData","partiallyFilled","_a","m","jsx","AlertDialog","AlertDialogContent","jsxs","AlertDialogHeader","AlertDialogTitle","AlertDialogDescription","Accordion","_b","AccordionItem","AccordionTrigger","AccordionContent","Dropdown","mealPreference","Input","AlertDialogFooter","Button"],"mappings":"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","x_google_ignoreList":[0]}